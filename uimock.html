<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XP-Optimise Prototype</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js CDN for charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style type="text/css">
        /* Root variables and base styles from core.html */
        :root {
            --bg-color: #f4f7fa;
            --card-bg: #ffffff;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --primary-color: #6366f1; /* Indigo */
            --primary-color-dark: #4f46e5;
            --secondary-color: #10b981; /* Emerald */
            --border-color: #e2e8f0;
            --shadow-sm: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
            --shadow-md: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.07);
        }

        body {
            background-color: var(--bg-color);
            font-family: 'Inter', sans-serif;
            color: var(--text-primary);
            overflow-x: hidden; /* Prevent horizontal scroll on small screens */
        }

        /* Glassmorphism Header */
        .glass-header {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.5);
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow-sm);
            padding: 24px;
            margin-bottom: 24px;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }
        .card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-4px);
        }

        .section-title {
            font-size: 1.125rem; /* 18px */
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
        }
        .section-title i {
            margin-right: 0.75rem;
            color: var(--primary-color);
        }

        .btn-primary {
            background-image: linear-gradient(to right, var(--primary-color) 0%, #a855f7 51%, var(--primary-color) 100%);
            background-size: 200% auto;
            color: white;
            font-weight: 600;
            padding: 12px 24px;
            border-radius: 10px;
            transition: all 0.4s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: none;
        }
        .btn-primary:hover {
            background-position: right center; /* change the direction of the change here */
            box-shadow: 0 4px 15px 0 rgba(120, 95, 239, 0.35);
        }
        .btn-primary:disabled {
            background-image: none;
            background-color: #a0aec0;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Custom Select Input */
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23a0aec0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.5em 1.5em;
        }

        select, input[type="text"], input[type="password"], input[type="email"], input[type="number"], textarea {
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 12px;
            width: 100%;
            transition: border-color 0.3s, box-shadow 0.3s;
            background-color: #f8fafc;
        }
        select:focus, input[type="text"]:focus, input[type="password"]:focus, input[type="email"]:focus, input[type="number"]:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }
        
        /* Navigation Menu & Tabs */
        .menu-item {
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }
        .menu-item:hover {
            background-color: #eef2ff; /* Indigo-100 */
            color: var(--primary-color);
        }
        .menu-item.active {
            background-color: var(--primary-color);
            color: white;
            box-shadow: var(--shadow-sm);
        }
        
        /* Chart Toggles as Segmented Control */
        .chart-toggle-group {
            background-color: #eef2ff;
            border-radius: 10px;
            padding: 4px;
            display: inline-flex;
        }
        .chart-toggle-btn {
            padding: 6px 16px;
            border-radius: 8px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            border: none;
            background-color: transparent;
            transition: all 0.3s ease;
        }
        .chart-toggle-btn.active {
            background-color: var(--card-bg);
            color: var(--primary-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            display: none; /* Hidden by default */
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Fade-in Animation */
        .fade-in {
            animation: fadeInAnimation ease 0.5s;
            animation-iteration-count: 1;
            animation-fill-mode: forwards;
        }
        @keyframes fadeInAnimation {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* Ticker Animation */
        .ticker-scroll {
            animation: tickerMove 20s linear infinite;
        }
        @keyframes tickerMove {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        .ticker-item {
            margin-right: 3rem;
        }

        /* Custom Modal Styles */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-in-out;
        }
        .modal.open {
            opacity: 1;
            pointer-events: auto;
        }
        .modal-content {
            background-color: var(--card-bg);
            margin: auto;
            padding: 30px;
            border-radius: 16px;
            box-shadow: var(--shadow-md);
            width: 90%;
            max-width: 500px;
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out;
        }
        .modal.open .modal-content {
            transform: translateY(0);
        }
        .close-button {
            color: var(--text-secondary);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }
        .close-button:hover,
        .close-button:focus {
            color: var(--primary-color);
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body class="p-4 sm:p-6">

    <div class="max-w-screen-2xl mx-auto">

        <!-- Header - Adopted from core.html -->
        <header id="main-header" class="sticky top-4 z-50 glass-header flex justify-between items-center mb-6 p-3 rounded-2xl hidden">
            <h1 class="text-2xl font-extrabold text-gray-800 tracking-tight">
                <i class="fa-solid fa-wand-magic-sparkles text-indigo-500"></i>
                OptimizeDemoâ„¢
            </h1>
            <nav class="hidden md:flex items-center space-x-2 bg-white/50 p-1 rounded-xl">
                <a href="#" class="menu-item active" onclick="showPage('dashboard')">Summary</a>
                <a href="#" class="menu-item" onclick="showPage('research')">Research</a>
                <a href="#" class="menu-item" onclick="showPage('recommendations')">Recommendations</a>
                <a href="#" class="menu-item" onclick="showPage('settings')">Settings</a>
            </nav>
            <div class="flex items-center space-x-4">
                <div id="status-indicator" class="flex items-center space-x-2">
                    <span id="status-text" class="text-green-500 font-bold bg-green-100 px-3 py-1 rounded-full text-xs">
                        <i class="fa-solid fa-circle mr-1"></i>Active
                    </span>
                </div>
                <div class="flex items-center space-x-3">
                     <img src="https://i.pravatar.cc/40?u=demoUser" alt="User Avatar" class="w-10 h-10 rounded-full border-2 border-indigo-200">
                </div>
            </div>
        </header>

        <!-- Login Page -->
        <div id="login-page" class="page min-h-screen flex items-center justify-center fade-in">
            <div class="card w-full max-w-md p-8">
                <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">
                    <i class="fa-solid fa-lock text-primary-color mr-2"></i>XP-Optimise Login
                </h2>
                <form id="login-form" onsubmit="handleLogin(event)">
                    <div class="mb-4">
                        <label for="username" class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <input type="text" id="username" name="username" class="w-full" placeholder="Enter your username" required>
                    </div>
                    <div class="mb-6">
                        <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input type="password" id="password" name="password" class="w-full" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="btn-primary w-full py-3">
                        <i class="fa-solid fa-right-to-bracket mr-2"></i>Login
                    </button>
                    <p id="login-error" class="text-red-500 text-center mt-4 hidden">Invalid credentials. Please try again.</p>
                </form>
            </div>
        </div>

        <!-- Dashboard Page -->
        <div id="dashboard-page" class="page hidden fade-in">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <!-- Filters -->
                <div class="card md:col-span-3 flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0 md:space-x-4">
                    <div class="w-full md:w-1/2">
                        <label for="campaign-filter" class="block text-sm font-medium text-gray-700 mb-2">Select Campaign</label>
                        <select id="campaign-filter" class="w-full" onchange="updateDashboard()">
                            <option value="all">All Campaigns</option>
                            <option value="campaign-alpha">Campaign Alpha (Q1)</option>
                            <option value="campaign-beta">Campaign Beta (Q2)</option>
                            <option value="campaign-gamma">Campaign Gamma (Q3)</option>
                        </select>
                    </div>
                    <div class="w-full md:w-1/2">
                        <label for="time-filter" class="block text-sm font-medium text-gray-700 mb-2">Performance Window</label>
                        <select id="time-filter" class="w-full" onchange="updateDashboard()">
                            <option value="7">Last 7 Days</option>
                            <option value="14">Last 14 Days</option>
                            <option value="30" selected>Last 30 Days</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Pane 1: Core Executive Level Metrics -->
                <div class="card lg:col-span-2">
                    <h3 class="section-title"><i class="fa-solid fa-chart-line"></i>Executive Performance Overview</h3>
                    <div class="overflow-x-auto mb-6">
                        <table class="min-w-full bg-white rounded-lg overflow-hidden">
                            <thead class="bg-gray-50">
                                <tr class="text-left text-xs text-gray-500 uppercase tracking-wider">
                                    <th class="py-3 px-4">Metric</th>
                                    <th class="py-3 px-4">Value</th>
                                    <th class="py-3 px-4">Innovid Benchmark</th>
                                    <th class="py-3 px-4">Status</th>
                                </tr>
                            </thead>
                            <tbody id="metrics-table-body" class="divide-y divide-gray-200">
                                <!-- Metrics will be populated by JS -->
                            </tbody>
                        </table>
                    </div>

                    <h3 class="section-title mt-8"><i class="fa-solid fa-chart-scatter"></i>Effectiveness vs. Efficiency</h3>
                    <div class="h-80">
                        <canvas id="effectivenessEfficiencyChart"></canvas>
                    </div>

                    <h3 class="section-title mt-8"><i class="fa-solid fa-chart-pie"></i>Channel Performance</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white rounded-lg overflow-hidden">
                            <thead class="bg-gray-50">
                                <tr class="text-left text-xs text-gray-500 uppercase tracking-wider">
                                    <th class="py-3 px-4">Channel</th>
                                    <th class="py-3 px-4">Spend</th>
                                    <th class="py-3 px-4">Conversions</th>
                                    <th class="py-3 px-4">ROAS</th>
                                    <th class="py-3 px-4">CPC</th>
                                </tr>
                            </thead>
                            <tbody id="channel-performance-body" class="divide-y divide-gray-200">
                                <!-- Channel performance will be populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pane 2: Top 3 Recommendations -->
                <div class="card lg:col-span-1">
                    <h3 class="section-title"><i class="fa-solid fa-lightbulb"></i>Top 3 Recommendations</h3>
                    <div id="top-recommendations-list">
                        <!-- Recommendations will be populated by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Research Page -->
        <div id="research-page" class="page hidden fade-in">
            <div class="card h-[70vh] flex flex-col">
                <h3 class="section-title"><i class="fa-solid fa-comment-dots"></i>Research Assistant</h3>
                <div id="chat-window" class="flex-grow bg-gray-50 p-4 rounded-xl overflow-y-auto mb-4 border border-gray-200">
                    <div class="chat-message bot">
                        <p class="bg-indigo-100 text-indigo-800 p-3 rounded-xl rounded-bl-none inline-block max-w-[80%]">Hello! How can I assist you with your campaign performance today?</p>
                    </div>
                </div>
                <div class="mb-4">
                    <label for="pre-canned-questions" class="block text-sm font-medium text-gray-700 mb-2">Or select a pre-canned question:</label>
                    <select id="pre-canned-questions" class="w-full" onchange="selectPreCannedQuestion()">
                        <option value="">Choose a question...</option>
                        <option value="What are the top factors driving the highest conversion rates?">What are the top factors driving the highest conversion rates?</option>
                        <option value="How can I reduce my Cost Per Conversion for Campaign Alpha?">How can I reduce my Cost Per Conversion for Campaign Alpha?</option>
                        <option value="What channels are underperforming this month?">What channels are underperforming this month?</option>
                        <option value="Provide a summary of Campaign Gamma's performance over the last 30 days.">Provide a summary of Campaign Gamma's performance over the last 30 days.</option>
                    </select>
                </div>
                <div class="flex items-center space-x-3">
                    <input type="text" id="research-query-input" class="flex-grow" placeholder="Ask a question..." onkeypress="handleResearchKeyPress(event)">
                    <button class="btn-primary p-3 w-1/4" onclick="handleResearchQuery()">
                        <i class="fa-solid fa-paper-plane mr-2"></i>Send
                    </button>
                </div>
                <div id="ai-typing-indicator" class="loader mt-4 mx-auto hidden"></div>
            </div>
        </div>

        <!-- Recommendation Page -->
        <div id="recommendations-page" class="page hidden fade-in">
            <div class="card">
                <h3 class="section-title"><i class="fa-solid fa-list-check"></i>All Recommendations</h3>
                <p class="text-gray-600 mb-6">Select one or more recommendations to see the combined benefits.</p>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Recommendations List -->
                    <div class="lg:col-span-1">
                        <div id="all-recommendations-list" class="space-y-4">
                            <!-- Recommendations will be populated by JS -->
                        </div>
                    </div>

                    <!-- Benefits and Explanation Panes -->
                    <div class="lg:col-span-1 space-y-6">
                        <div class="card p-4">
                            <h4 class="section-title !text-base"><i class="fa-solid fa-arrow-trend-up"></i>Predicted Benefits</h4>
                            <div id="benefits-pane" class="text-sm text-gray-700">
                                <p>Select recommendations to see predicted changes in metrics.</p>
                            </div>
                        </div>
                        <div class="card p-4">
                            <h4 class="section-title !text-base"><i class="fa-solid fa-circle-info"></i>Explanation</h4>
                            <div id="explanation-pane" class="text-sm text-gray-700">
                                <p>Justification for selected recommendations will appear here.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row justify-end mt-8 space-y-4 sm:space-y-0 sm:space-x-4">
                    <button class="btn-primary" onclick="exportPresentationData()">
                        <i class="fa-solid fa-file-export mr-2"></i>Export Presentation Data
                    </button>
                    <button id="apply-recommendations-btn" class="btn-primary" onclick="showApplyConfirmationModal()" disabled>
                        <i class="fa-solid fa-check-circle mr-2"></i>Apply Recommendations
                    </button>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings-page" class="page hidden fade-in">
            <div class="card">
                <h3 class="section-title mb-6"><i class="fa-solid fa-cog"></i>Settings</h3>

                <!-- Account & Profile Management -->
                <div class="mb-8">
                    <h4 class="section-title !text-base !mb-4"><i class="fa-solid fa-user-circle"></i>Account & Profile</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="settings-username" class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                            <input type="text" id="settings-username" value="demoUser" readonly class="bg-gray-100 cursor-not-allowed">
                        </div>
                        <div>
                            <label for="settings-email" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input type="email" id="settings-email" value="demo.user@innovid.com" readonly class="bg-gray-100 cursor-not-allowed">
                        </div>
                    </div>
                    <button class="btn-primary !py-2 !px-4 mt-4" disabled>
                        <i class="fa-solid fa-key mr-2"></i>Change Password (Non-functional)
                    </button>
                </div>

                <!-- Campaign Preferences -->
                <div class="mb-8">
                    <h4 class="section-title !text-base !mb-4"><i class="fa-solid fa-bullseye"></i>Campaign Preferences</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="optimization-objective" class="block text-sm font-medium text-gray-700 mb-2">Optimization Objective</label>
                            <select id="optimization-objective" class="w-full">
                                <option value="roas">Maximize ROAS</option>
                                <option value="conversions">Increase Conversions</option>
                                <option value="cpc">Reduce Cost Per Conversion</option>
                                <option value="reach">Maximize Reach</option>
                            </select>
                        </div>
                        <div>
                            <label for="alert-metric" class="block text-sm font-medium text-gray-700 mb-2">Set Alert for Metric</label>
                            <select id="alert-metric" class="w-full">
                                <option value="cpc">Cost Per Conversion (CPC)</option>
                                <option value="cpm">Cost Per Mille (CPM)</option>
                                <option value="ctr">Click-Through Rate (CTR)</option>
                            </select>
                        </div>
                        <div>
                            <label for="alert-threshold" class="block text-sm font-medium text-gray-700 mb-2">Alert Threshold</label>
                            <input type="number" id="alert-threshold" placeholder="e.g., 0.5 for CTR, 1.20 for CPC" class="w-full">
                        </div>
                    </div>
                    <button class="btn-primary !py-2 !px-4 mt-4" onclick="saveSettings()">
                        <i class="fa-solid fa-save mr-2"></i>Save Preferences
                    </button>
                </div>

                <!-- Notification Settings -->
                <div>
                    <h4 class="section-title !text-base !mb-4"><i class="fa-solid fa-bell"></i>Notification Settings</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="notification-email" class="block text-sm font-medium text-gray-700 mb-2">Notification Email</label>
                            <input type="email" id="notification-email" placeholder="Enter email for updates">
                        </div>
                        <div>
                            <label for="recommendation-cadence" class="block text-sm font-medium text-gray-700 mb-2">Recommendation Cadence</label>
                            <select id="recommendation-cadence" class="w-full">
                                <option value="daily">Daily</option>
                                <option value="weekly" selected>Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn-primary !py-2 !px-4 mt-4" onclick="saveSettings()">
                        <i class="fa-solid fa-save mr-2"></i>Save Notifications
                    </button>
                </div>
            </div>
        </div>

    </div>

    <!-- Custom Confirmation Modal -->
    <div id="confirmation-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <h3 class="section-title !text-xl !mb-4"><i class="fa-solid fa-circle-question"></i>Confirm Application</h3>
            <p id="modal-message" class="mb-6 text-gray-700">Are you sure you want to apply these recommendations?</p>
            <div class="flex justify-end space-x-4">
                <button class="btn-primary bg-gray-300 !bg-none !text-gray-800 hover:!bg-gray-200" onclick="closeModal()">Cancel</button>
                <button class="btn-primary" onclick="confirmApply()">Confirm Apply</button>
            </div>
        </div>
    </div>


    <script>
        // --- Global Data & State ---
        let currentChart; // To hold the Chart.js instance
        const recommendedUsername = "user";
        const recommendedPassword = "password";

        const dummyMetrics = {
            "all": {
                impressions: "15.2M", reach: "8.5M", frequency: "1.8x", conversions: "75,000", roas: "3.2x", cpc: "$1.20", ctr: "0.8%",
                benchmark: { impressions: "14M", reach: "8M", frequency: "1.7x", conversions: "70,000", roas: "3.0x", cpc: "$1.30", ctr: "0.75%" }
            },
            "campaign-alpha": {
                impressions: "6.1M", reach: "3.5M", frequency: "1.7x", conversions: "32,000", roas: "3.5x", cpc: "$1.10", ctr: "0.9%",
                benchmark: { impressions: "6M", reach: "3.2M", frequency: "1.6x", conversions: "30,000", roas: "3.3x", cpc: "$1.15", ctr: "0.85%" }
            },
            "campaign-beta": {
                impressions: "5.0M", reach: "2.8M", frequency: "1.9x", conversions: "25,000", roas: "2.9x", cpc: "$1.35", ctr: "0.7%",
                benchmark: { impressions: "5.2M", reach: "3.0M", frequency: "1.8x", conversions: "27,000", roas: "3.1x", cpc: "$1.25", ctr: "0.78%" }
            },
            "campaign-gamma": {
                impressions: "4.1M", reach: "2.2M", frequency: "1.8x", conversions: "18,000", roas: "3.0x", cpc: "$1.25", ctr: "0.85%",
                benchmark: { impressions: "3.8M", reach: "2.0M", frequency: "1.7x", conversions: "16,000", roas: "2.8x", cpc: "$1.32", ctr: "0.80%" }
            }
        };

        const channelPerformance = {
            "all": [
                { channel: "Programmatic Display", spend: "$50K", conversions: "30,000", roas: "3.0x", cpc: "$1.50" },
                { channel: "Social Media", spend: "$40K", conversions: "25,000", roas: "3.5x", cpc: "$1.00" },
                { channel: "Connected TV", spend: "$30K", conversions: "15,000", roas: "2.8x", cpc: "$2.00" },
                { channel: "Audio Ads", spend: "$20K", conversions: "5,000", roas: "2.0x", cpc: "$4.00" }
            ],
            "campaign-alpha": [
                { channel: "Programmatic Display", spend: "$20K", conversions: "15,000", roas: "3.2x", cpc: "$1.30" },
                { channel: "Social Media", spend: "$15K", conversions: "12,000", roas: "3.8x", cpc: "$0.90" },
                { channel: "Connected TV", spend: "$10K", conversions: "5,000", roas: "3.0x", cpc: "$2.20" }
            ],
            "campaign-beta": [
                { channel: "Social Media", spend: "$20K", conversions: "10,000", roas: "2.7x", cpc: "$1.80" },
                { channel: "Connected TV", spend: "$15K", conversions: "8,000", roas: "2.5x", cpc: "$2.50" },
                { channel: "Audio Ads", spend: "$10K", conversions: "7,000", roas: "2.2x", cpc: "$1.40" }
            ],
            "campaign-gamma": [
                { channel: "Programmatic Display", spend: "$15K", conversions: "10,000", roas: "3.1x", cpc: "$1.50" },
                { channel: "Social Media", spend: "$10K", conversions: "6,000", roas: "3.0x", cpc: "$1.60" },
                { channel: "Audio Ads", spend: "$5K", conversions: "2,000", roas: "2.1x", cpc: "$2.50" }
            ]
        };

        const allRecommendations = [
            {
                id: 'rec1',
                action: 'Increase Budget',
                target: 'Campaign Alpha - Social Media',
                benefit: '+15% Conversions, +10% ROAS',
                explanation: 'Increasing budget for high-performing Social Media ads in Campaign Alpha will capitalize on positive ROI trends and reach more engaged users.',
                type: 'Increase Budget',
                category: 'Budget'
            },
            {
                id: 'rec2',
                action: 'Decrease Bid',
                target: 'Campaign Beta - Connected TV',
                benefit: '-10% CPC, +5% Impressions',
                explanation: 'Lowering bids on underperforming Connected TV placements in Campaign Beta can improve Cost Per Conversion while maintaining impression volume.',
                type: 'Decrease Bid',
                category: 'Bids'
            },
            {
                id: 'rec3',
                action: 'Increase Bid',
                target: 'Campaign Alpha - Programmatic Display',
                benefit: '+8% Reach, +5% Impressions',
                explanation: 'Aggressively bidding on high-value Programmatic Display inventory in Campaign Alpha will secure premium placements and expand reach.',
                type: 'Increase Bid',
                category: 'Bids'
            },
            {
                id: 'rec4',
                action: 'Decrease Budget',
                target: 'Campaign Gamma - Audio Ads',
                benefit: '-20% Spend, Maintain ROAS',
                explanation: 'Reducing spend on Audio Ads in Campaign Gamma, which have diminishing returns, will optimize budget allocation without significantly impacting ROAS.',
                type: 'Decrease Budget',
                category: 'Budget'
            },
            {
                id: 'rec5',
                action: 'Increase Budget',
                target: 'Campaign Beta - Social Media',
                benefit: '+12% Conversions, +8% ROAS',
                explanation: 'Allocating more budget to high-converting Social Media campaigns in Campaign Beta will accelerate growth and improve overall campaign efficiency.',
                type: 'Increase Budget',
                category: 'Budget'
            },
            {
                id: 'rec6',
                action: 'Decrease Bid',
                target: 'Campaign Alpha - Connected TV',
                benefit: '-7% CPC, Improve ROAS',
                explanation: 'Adjusting bids downward on less efficient Connected TV segments in Campaign Alpha can reduce acquisition costs and enhance profitability.',
                type: 'Decrease Bid',
                category: 'Bids'
            },
            {
                id: 'rec7',
                action: 'Increase Bid',
                target: 'Campaign Gamma - Programmatic Display',
                benefit: '+10% Impressions, +6% CTR',
                explanation: 'Higher bids for top-performing Programmatic Display ads in Campaign Gamma will increase visibility and click-through rates.',
                type: 'Increase Bid',
                category: 'Bids'
            },
            {
                id: 'rec8',
                action: 'Decrease Budget',
                target: 'Campaign Alpha - Search Ads',
                benefit: '-10% Spend, Reallocate',
                explanation: 'Shifting budget from lower-priority Search Ads in Campaign Alpha frees up funds for more impactful channels.',
                type: 'Decrease Budget',
                category: 'Budget'
            },
            {
                id: 'rec9',
                action: 'Increase Budget',
                target: 'Campaign Beta - Native Ads',
                benefit: '+8% Reach, +5% Conversions',
                explanation: 'Investing more in Native Ads for Campaign Beta can tap into new audiences and drive incremental conversions.',
                type: 'Increase Budget',
                category: 'Budget'
            },
            {
                id: 'rec10',
                action: 'Increase Bid',
                target: 'Campaign Alpha - Video Ads',
                benefit: '+12% Video Views, +7% Engagement',
                explanation: 'Boosting bids for high-quality Video Ads in Campaign Alpha will ensure prime placements and increase viewer engagement.',
                type: 'Increase Bid',
                category: 'Bids'
            }
        ];

        const researchFAQs = {
            "What are the top factors driving the highest conversion rates?": "Our analysis indicates that **Ad Creative Quality**, **Targeting Precision**, and **Bid Strategy Optimization** are the primary factors driving the highest conversion rates. Campaigns with highly relevant and engaging creative, coupled with granular audience targeting, consistently outperform others. Furthermore, dynamic bid adjustments based on real-time performance data significantly enhance conversion efficiency.",
            "How can I reduce my Cost Per Conversion for Campaign Alpha?": "To reduce Cost Per Conversion (CPC) for Campaign Alpha, consider **optimizing your bid strategy** for lower-performing ad groups, **refining audience targeting** to reduce wasted impressions, and **A/B testing ad creatives** to improve engagement. Specifically, we recommend evaluating your Connected TV placements for potential bid reductions and ensuring your landing pages are fully optimized for mobile conversion.",
            "What channels are underperforming this month?": "Based on current data, **Audio Ads** and certain segments of **Connected TV** are currently underperforming in terms of ROAS and CPC across your portfolio. We recommend reviewing the creative and targeting parameters for these channels. For Audio Ads, consider reallocating budget to higher-performing channels or testing new audience segments. For Connected TV, a slight reduction in bids on less effective inventory may improve efficiency.",
            "Provide a summary of Campaign Gamma's performance over the last 30 days.": "Over the last 30 days, Campaign Gamma has achieved **4.1M Impressions** and **18,000 Conversions** with a **ROAS of 3.0x** and a **CPC of $1.25**. While overall performance is solid, the **Programmatic Display** channel is a strong performer. Audio Ads show lower efficiency, suggesting potential for optimization or reallocation of spend. The campaign is currently exceeding its benchmark for impressions and conversions."
        };

        // --- Page Navigation ---
        function showPage(pageName) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.add('hidden'));

            const activePage = document.getElementById(`${pageName}-page`);
            if (activePage) {
                activePage.classList.remove('hidden');
                activePage.classList.add('fade-in');
            }

            // Update active menu item
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => item.classList.remove('active'));
            const activeMenuItem = document.querySelector(`.menu-item[onclick*="showPage('${pageName}')"]`);
            if (activeMenuItem) {
                activeMenuItem.classList.add('active');
            }

            // Specific updates for dashboard
            if (pageName === 'dashboard') {
                updateDashboard();
            }
            if (pageName === 'recommendations') {
                populateAllRecommendations();
                updateBenefitsAndExplanation(); // Ensure initial state is clear
            }
        }

        // --- Login Logic ---
        function handleLogin(event) {
            event.preventDefault(); // Prevent default form submission
            const usernameInput = document.getElementById('username').value;
            const passwordInput = document.getElementById('password').value;
            const loginError = document.getElementById('login-error');
            const mainHeader = document.getElementById('main-header');

            if (usernameInput === recommendedUsername && passwordInput === recommendedPassword) {
                loginError.classList.add('hidden');
                document.getElementById('login-page').classList.add('hidden');
                mainHeader.classList.remove('hidden');
                showPage('dashboard'); // Go to dashboard after successful login
            } else {
                loginError.classList.remove('hidden');
            }
        }

        // --- Dashboard Logic ---
        function updateDashboard() {
            const campaignFilter = document.getElementById('campaign-filter').value;
            const timeFilter = document.getElementById('time-filter').value; // Not used for data variation yet, but available
            const metrics = dummyMetrics[campaignFilter];
            const channels = channelPerformance[campaignFilter];

            // Update Metrics Table
            const metricsTableBody = document.getElementById('metrics-table-body');
            metricsTableBody.innerHTML = `
                ${createMetricRow('Impressions', metrics.impressions, metrics.benchmark.impressions)}
                ${createMetricRow('Reach', metrics.reach, metrics.benchmark.reach)}
                ${createMetricRow('Frequency', metrics.frequency, metrics.benchmark.frequency)}
                ${createMetricRow('Conversions', metrics.conversions, metrics.benchmark.conversions)}
                ${createMetricRow('ROAS', metrics.roas, metrics.benchmark.roas)}
                ${createMetricRow('Cost Per Conversion (CPC)', metrics.cpc, metrics.benchmark.cpc)}
                ${createMetricRow('Click-Through Rate (CTR)', metrics.ctr, metrics.benchmark.ctr)}
            `;

            // Update Effectiveness vs. Efficiency Chart
            updateEffectivenessEfficiencyChart(campaignFilter);

            // Update Channel Performance Table
            const channelPerformanceBody = document.getElementById('channel-performance-body');
            channelPerformanceBody.innerHTML = channels.map(channel => `
                <tr>
                    <td class="py-3 px-4">${channel.channel}</td>
                    <td class="py-3 px-4">${channel.spend}</td>
                    <td class="py-3 px-4">${channel.conversions}</td>
                    <td class="py-3 px-4">${channel.roas}</td>
                    <td class="py-3 px-4">${channel.cpc}</td>
                </tr>
            `).join('');

            // Update Top 3 Recommendations
            populateTopRecommendations();
        }

        function createMetricRow(label, value, benchmark) {
            const isBetter = parseFloat(value) >= parseFloat(benchmark) || (label.includes('Cost') && parseFloat(value) <= parseFloat(benchmark));
            const statusClass = isBetter ? 'text-green-600' : 'text-red-600';
            const icon = isBetter ? '<i class="fa-solid fa-arrow-up text-xs ml-1"></i>' : '<i class="fa-solid fa-arrow-down text-xs ml-1"></i>';

            return `
                <tr>
                    <td class="py-3 px-4 text-sm font-medium text-gray-900">${label}</td>
                    <td class="py-3 px-4 text-sm text-gray-700">${value}</td>
                    <td class="py-3 px-4 text-sm text-gray-700">${benchmark}</td>
                    <td class="py-3 px-4 text-sm ${statusClass}">${isBetter ? 'Above Benchmark' : 'Below Benchmark'} ${icon}</td>
                </tr>
            `;
        }

        function updateEffectivenessEfficiencyChart(campaign) {
            const ctx = document.getElementById('effectivenessEfficiencyChart').getContext('2d');

            // Dummy data for scatter plot (Cost Per Conversion vs. Conversions %)
            const data = {
                'all': [{ x: 1.20, y: 7.5 }, { x: 1.10, y: 8.2 }, { x: 1.35, y: 6.8 }, { x: 1.25, y: 7.0 }, { x: 1.15, y: 7.9 }],
                'campaign-alpha': [{ x: 1.10, y: 8.0 }, { x: 1.05, y: 8.5 }, { x: 1.20, y: 7.8 }],
                'campaign-beta': [{ x: 1.35, y: 6.5 }, { x: 1.40, y: 6.2 }, { x: 1.28, y: 7.0 }],
                'campaign-gamma': [{ x: 1.25, y: 7.2 }, { x: 1.30, y: 6.9 }, { x: 1.18, y: 7.5 }]
            }[campaign];

            if (currentChart) {
                currentChart.destroy();
            }

            currentChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Campaign Effectiveness vs. Efficiency',
                        data: data,
                        backgroundColor: 'rgba(99, 102, 241, 0.7)',
                        borderColor: 'rgba(99, 102, 241, 1)',
                        pointRadius: 8,
                        pointHoverRadius: 10,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Cost Per Conversion (CPC)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Conversions (%)'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `CPC: $${context.parsed.x.toFixed(2)}, Conversions: ${context.parsed.y.toFixed(1)}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function populateTopRecommendations() {
            const topRecommendationsList = document.getElementById('top-recommendations-list');
            topRecommendationsList.innerHTML = ''; // Clear previous

            // Get first 3 recommendations, could be dynamic based on campaign later
            const top3Recs = allRecommendations.slice(0, 3);

            top3Recs.forEach(rec => {
                const recDiv = document.createElement('div');
                recDiv.className = 'bg-indigo-50 p-4 rounded-xl mb-4 border border-indigo-200';
                recDiv.innerHTML = `
                    <p class="font-semibold text-indigo-800 text-lg mb-2"><i class="fa-solid fa-bolt mr-2 text-indigo-500"></i>${rec.action} ${rec.target}</p>
                    <p class="text-sm text-gray-700 mb-2"><strong>Benefit:</strong> <span class="text-green-700 font-medium">${rec.benefit}</span></p>
                    <p class="text-xs text-gray-600 mb-3">${rec.explanation}</p>
                    <div class="flex space-x-2">
                        <button class="btn-primary !py-2 !px-3 !text-sm" onclick="showPage('recommendations'); selectRecommendation('${rec.id}');">
                            <i class="fa-solid fa-eye mr-1"></i>View
                        </button>
                        <button class="btn-primary !py-2 !px-3 !text-sm" onclick="showApplyConfirmationModal('Applying Top Recommendation: ${rec.action} on ${rec.target}')">
                            <i class="fa-solid fa-check mr-1"></i>Apply
                        </button>
                        <button class="btn-primary !py-2 !px-3 !text-sm !bg-gray-200 !text-gray-700 !bg-none hover:!bg-gray-300" onclick="alert('Recommendation dismissed! (Simulated)')">
                            <i class="fa-solid fa-times mr-1"></i>Dismiss
                        </button>
                    </div>
                `;
                topRecommendationsList.appendChild(recDiv);
            });
        }

        // --- Research Page Logic ---
        function appendMessage(sender, message) {
            const chatWindow = document.getElementById('chat-window');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender} mb-4`;
            const bgColor = sender === 'user' ? 'bg-blue-500 text-white' : 'bg-indigo-100 text-indigo-800';
            const borderRadius = sender === 'user' ? 'rounded-xl rounded-br-none' : 'rounded-xl rounded-bl-none';
            messageDiv.innerHTML = `<p class="${bgColor} p-3 ${borderRadius} inline-block max-w-[80%]">${message}</p>`;
            chatWindow.appendChild(messageDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight; // Scroll to bottom
        }

        function handleResearchKeyPress(event) {
            if (event.key === 'Enter') {
                handleResearchQuery();
            }
        }

        function handleResearchQuery() {
            const queryInput = document.getElementById('research-query-input');
            const query = queryInput.value.trim();
            if (query === '') return;

            appendMessage('user', query);
            queryInput.value = '';

            const typingIndicator = document.getElementById('ai-typing-indicator');
            typingIndicator.classList.remove('hidden');

            setTimeout(() => {
                const response = researchFAQs[query] || "I'm sorry, I don't have information on that specific query in my prototype database. Please try a pre-canned question or rephrase your request.";
                appendMessage('bot', response);
                typingIndicator.classList.add('hidden');
            }, 1500 + Math.random() * 1000); // Simulate typing delay
        }

        function selectPreCannedQuestion() {
            const selectElement = document.getElementById('pre-canned-questions');
            const selectedQuestion = selectElement.value;
            if (selectedQuestion) {
                document.getElementById('research-query-input').value = selectedQuestion;
                handleResearchQuery();
                selectElement.value = ''; // Reset select
            }
        }

        // --- Recommendation Page Logic ---
        function populateAllRecommendations() {
            const allRecsList = document.getElementById('all-recommendations-list');
            allRecsList.innerHTML = ''; // Clear previous

            allRecommendations.forEach(rec => {
                const recDiv = document.createElement('label');
                recDiv.className = 'block bg-white p-4 rounded-xl border border-gray-200 cursor-pointer hover:border-indigo-400 transition-all';
                recDiv.innerHTML = `
                    <input type="radio" name="selected-recommendations" value="${rec.id}" class="mr-3 align-middle" onchange="updateBenefitsAndExplanation()">
                    <span class="font-semibold text-lg text-indigo-800">${rec.action} ${rec.target}</span>
                    <p class="text-sm text-gray-700 mt-1">${rec.explanation}</p>
                `;
                allRecsList.appendChild(recDiv);
            });
        }

        function updateBenefitsAndExplanation() {
            const selectedRadio = document.querySelector('input[name="selected-recommendations"]:checked');
            const benefitsPane = document.getElementById('benefits-pane');
            const explanationPane = document.getElementById('explanation-pane');
            const applyBtn = document.getElementById('apply-recommendations-btn');

            if (selectedRadio) {
                const selectedRecId = selectedRadio.value;
                const selectedRec = allRecommendations.find(rec => rec.id === selectedRecId);

                if (selectedRec) {
                    // Simulate benefit estimation (smoke and mirrors)
                    const conversionLift = (Math.random() * (0.15 - 0.05) + 0.05) * 100; // 5-15% lift
                    const roasLift = (Math.random() * (0.10 - 0.03) + 0.03) * 100; // 3-10% lift
                    const cpcReduction = (Math.random() * (0.15 - 0.05) + 0.05) * 100; // 5-15% reduction

                    benefitsPane.innerHTML = `
                        <ul class="list-disc list-inside space-y-1">
                            <li><strong>Conversions:</strong> Up by ~${conversionLift.toFixed(1)}%</li>
                            <li><strong>ROAS:</strong> Up by ~${roasLift.toFixed(1)}%</li>
                            <li><strong>Cost Per Conversion:</strong> Down by ~${cpcReduction.toFixed(1)}%</li>
                        </ul>
                        <p class="mt-2 text-xs text-gray-500">*Estimates are illustrative for prototype demonstration.</p>
                    `;
                    explanationPane.textContent = selectedRec.explanation;
                    applyBtn.disabled = false;
                }
            } else {
                benefitsPane.innerHTML = '<p>Select recommendations to see predicted changes in metrics.</p>';
                explanationPane.innerHTML = '<p>Justification for selected recommendations will appear here.</p>';
                applyBtn.disabled = true;
            }
        }

        function showApplyConfirmationModal(message = 'Are you sure you want to apply these recommendations?') {
            const modal = document.getElementById('confirmation-modal');
            document.getElementById('modal-message').textContent = message;
            modal.classList.add('open');
        }

        function closeModal() {
            const modal = document.getElementById('confirmation-modal');
            modal.classList.remove('open');
        }

        function confirmApply() {
            closeModal();
            // In a real app, this would trigger an API call
            alert('Recommendations applied successfully! (Simulated)'); // Placeholder for actual success UI
        }

        function exportPresentationData() {
            const campaign = document.getElementById('campaign-filter').value;
            const metrics = dummyMetrics[campaign];
            const channels = channelPerformance[campaign];

            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Metric,Value,Innovid Benchmark\n";
            for (const key in metrics) {
                if (typeof metrics[key] === 'string') { // Only include top-level metrics
                    csvContent += `${key},${metrics[key]},${metrics.benchmark[key]}\n`;
                }
            }
            csvContent += "\nChannel,Spend,Conversions,ROAS,CPC\n";
            channels.forEach(row => {
                csvContent += `${row.channel},${row.spend},${row.conversions},${row.roas},${row.cpc}\n`;
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "XP_Optimise_Presentation_Data.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            alert('Presentation data exported as CSV! (Simulated)');
        }

        // --- Settings Page Logic ---
        function saveSettings() {
            const objective = document.getElementById('optimization-objective').value;
            const alertMetric = document.getElementById('alert-metric').value;
            const alertThreshold = document.getElementById('alert-threshold').value;
            const notificationEmail = document.getElementById('notification-email').value;
            const cadence = document.getElementById('recommendation-cadence').value;

            // In a real app, these would be saved to a backend
            console.log("Settings Saved:", { objective, alertMetric, alertThreshold, notificationEmail, cadence });
            alert('Settings saved successfully! (Simulated)');
        }

        // --- Initial Load ---
        window.onload = function() {
            // Initially show login page
            showPage('login');
            // Ensure header is hidden until login
            document.getElementById('main-header').classList.add('hidden');
        };

        // Ensure Chart.js renders correctly on resize (though responsive: true helps)
        window.addEventListener('resize', () => {
            if (document.getElementById('dashboard-page').classList.contains('hidden') === false) {
                updateEffectivenessEfficiencyChart(document.getElementById('campaign-filter').value);
            }
        });

    </script>
</body>
</html>
